/*! WoW Progression v1.3.0
	by Rob G (Mottie)
	https://github.com/Mottie/wowProgression
	http://www.opensource.org/licenses/mit-license.php
*/
;(function(r){r.fn.wowProgression=function(Q){return this.each(function(){if(!this.initialized){var G=this,a=r.extend({region:"us",locale:"en_US",server:"Lightning's Blade",guild:"Our Guild's Name",raiders:{},show:["mists"],heroics:!0,ratio:0.75,count:"{p}",status:"{s}",useAbbr:!1,text:{zero:"",none:"",killed:"Killed"},tooltip:"tooltip",allexps:{mists:"Mists of Pandaria",cat:"Catacylsm"},allraids:{mists:[{abbr:"ToT",hasHeroic:!0,id:6622,icons:[69465,68476,69078,67977,68066,68177,67827,69017,69427, 68078,68904,68397,69473],heroicBoss:!0},{abbr:"ToES",hasHeroic:!0,id:6067,icons:[60583,62442,62983,60999]},{abbr:"HoF",hasHeroic:!0,id:6297,icons:[62980,62543,62164,62397,62511,62837]},{abbr:"MV",hasHeroic:!0,id:6125,icons:[60051,60009,60143,60701,60410,60396]}],cat:[{abbr:"DS",hasHeroic:!0,id:5892,icons:[55265,55308,55312,55689,55294,56427,53879,57962]},{abbr:"FL",hasHeroic:!0,id:5723,icons:[52498,52558,53691,52530,53494,52571,52409]},{abbr:"ToFW",hasHeroic:!0,id:5638,icons:[45871,46753]},{abbr:"BoT", hasHeroic:!0,id:5334,icons:[44600,45993,43687,43324,45213],heroicBoss:!0},{abbr:"BD",hasHeroic:!0,id:5094,icons:[42179,41570,41442,43296,41378,41376]},{abbr:"BH",hasHeroic:!1,id:5600,icons:[47120,52363,55869]}]},initialized:null,details:!1,clickForDetails:!0,debug:!1},Q),O="http://"+("cn"===a.region?"www.battlenet.com.cn":a.region+".battle.net")+"/api/wow/character/"+a.server+"/",w=[],x={},L=[],u,M=!1,E={},H=function(a){console&&console.log&&console.log(a)};u=function(b){return jQuery.getJSON(O+b+ "?locale="+a.locale+"&fields=progression&jsonp=?",function(d){if(d&&d.progression){var b=d.name.toLocaleLowerCase();L.push(b);w.push(d.progression.raids);a.debug&&H([b,"URL: "+O+b+"?locale="+a.locale+"&fields=progression",d])}})};var t=function(a){return a.replace(/'/g,"'").replace(/"/g,"&quot;")},P=function(){if(!M){var b,d,e,g,c,j,f,p,q,I,y,B,C,F,u,z,A,s="",J,K,k,l,v,m,D,n,h;for(b=0;b<a.show.length;b++){n=a.show[b];a.debug&&(E[n]={});m=a.allraids[n];h=x[n].length;s+='<h3 class="expansion expansion-'+ n+'">'+a.allexps[n]+'</h3><div class="instances instances-'+n+'">';for(d=0;d<m.length;d++)if(w[0])for(e=0;e<w[0].length;e++)if((v=w[0][e]||null)&&v.id===m[d].id){m[d].name=v.name;a.debug&&(E[n][v.name]={});l=k="";u=[];z=[];A=[];D=v.bosses;q=I=0;B=y=D.length;for(g=0;g<y;g++)if(m[d].icons[g]){u.push(g+1);for(c=J=F=K=C=0;c<h;c++)p=x[n][c],j=r.inArray((p||"").toLocaleLowerCase(),L),0<=j&&(z[c]||(z[c]=[p]),A[c]||(A[c]=[p]),0<w[j][e].bosses[g].normalKills?(z[c].push("+"),C++,K+=w[j][e].bosses[g].normalKills): z[c].push("-"),0<w[j][e].bosses[g].heroicKills?(A[c].push("+"),F++,J+=w[j][e].bosses[g].heroicKills):A[c].push("-"));C/h>=a.ratio&&I++;F/h>=a.ratio&&q++;j=t(a.status).replace(/\{(s|n)\}/g,function(b){return{"{s}":C/h>=a.ratio?t(a.text.killed):t(a.text.none),"{n}":K/h<a.ratio?t(a.text.zero):Math.ceil(K/h)}[b]});m[d].heroicBoss&&g===v.bosses.length-1?B=y-1:(k+="<div class='boss "+(C/h>=a.ratio?"boss-killed":"")+"'><img class='boss-icon' src='http://media.blizzard.com/wow/renders/npcs/portrait/creature"+ m[d].icons[g]+".jpg'><span class='boss-name'>"+t(D[g].name)+"</span><span class='boss-status'>"+j+"</span></div>",a.debug&&(E[n][v.name][D[g].name]="ratio: "+C/h+", normal: "+(C/h>=a.ratio?"+":"-")+", "));a.heroics&&(j=t(a.status).replace(/\{(s|n)\}/g,function(b){return{"{s}":F/h>=a.ratio?t(a.text.killed):t(a.text.none),"{n}":J/h<a.ratio?t(a.text.zero):Math.ceil(J/h)}[b]}),l+="<div class='boss "+(F/h>=a.ratio?"boss-killed":"")+"'><img class='boss-icon' src='http://media.blizzard.com/wow/renders/npcs/portrait/creature"+ m[d].icons[g]+".jpg'><span class='boss-name'>"+t(D[g].name)+"</span><span class='boss-status'>"+j+"</span></div>",a.debug&&(E[n][v.name][D[g].name]=(E[n][v.name][D[g].name]||"")+"heroic: "+(F/h>=a.ratio?"+":"-")))}else y-=1,B-=1;f=Math.round(100*(I/B))+"%";j=a.count.replace(/\{[n|p|t]\}/g,function(a){return{"{p}":f,"{n}":I,"{t}":B}[a]});k="<div class='inst'><div class='inst-title'>Normal <span class='inst-count'>"+I+"/"+B+" ("+f+")</span></div></div>"+k;k+="<div class='details'"+(a.details?"":" style='display:none'")+ "><hr><table><tr><td>Raider</td><td class='mono'>"+u.join(" ")+"</td></tr>";for(c=0;c<h;c++)z[c]&&(k+="<tr><td>"+z[c].shift()+"</td><td class='mono'>"+z[c].join(" ")+"</td></tr>");k+="</table></div>";s+='<table class="instance inst-'+m[d].abbr+'"><tr><td'+(a.heroics&&m[d].hasHeroic?' rowspan="2"':"")+' class="icon"><div class="icon"></div></td><td><span class="inst-name">'+m[d][a.useAbbr?"abbr":"name"]+'</span><div class="bar-bkgd bar-normal '+a.tooltip+'" title="<div class=tips>'+k+'</div>"><div class="bar-color" style="width: '+ f+';"><span class="bar-text">'+j+"</span></div></td></tr>";if(a.heroics&&m[d].hasHeroic){f=Math.round(100*(q/y))+"%";j=a.count.replace(/\{[n|p|t]\}/g,function(a){return{"{p}":f,"{n}":q,"{t}":y}[a]});l="<div class='inst'><div class='inst-title'>Heroic <span class='inst-count'>"+q+"/"+y+" ("+f+")</span></div></div>"+l;l+="<div class='details'"+(a.details?"":" style='display:none'")+"><hr><table><tr><td>Raider</td><td class='mono'>"+u.join(" ")+"</td></tr>";for(c=0;c<h;c++)A[c]&&(l+="<tr><td>"+A[c].shift()+ "</td><td class='mono'>"+A[c].join(" ")+"</td></tr>");l+="</table></div>";s+='<tr><td><div class="bar-bkgd bar-heroic '+a.tooltip+'" title="<div class=tips>'+l+'"><div class="bar-color" style="width: '+f+';"><span class="bar-text">'+j+"</span></div></div></td></tr>"}s+="</div>"}s+="</table></div>"}a.debug&&H(E);r(G).addClass("wowprogression").html(s);!a.details&&a.clickForDetails&&r(G).find(".bar-bkgd").unbind("click").bind("click",function(){r(".tips .details").toggle()});"function"===typeof a.initialized&& !G.initialized&&a.initialized(G);G.initialized=!0}},b,e,p,q,f=[],N=[];for(e in a.raiders)if(a.raiders.hasOwnProperty(e)&&("all"===e||0<=r.inArray(e,a.show))){b=a.raiders[e];for(p=0;p<b.length;p++)if(""!==b[p])if(f.push(b[p]),"all"===e)for(q=0;q<a.show.length;q++)x[a.show[q]]||(x[a.show[q]]=[]),x[a.show[q]].push(b[p]);else x[e]||(x[e]=[]),x[e].push(b[p]);a.debug&&H("Expansion ("+e+") raiders: "+b)}f=r.grep(f,function(a,b){return r.inArray(a,f)===b});for(b=0;b<f.length;b++)f[b]&&(f[b]=f[b].toLocaleLowerCase(), N.push(u(f[b])));N.length&&(u=r.when.apply(r,N),u.done(function(){a.debug&&H("Loading complete: processing...");P();M=!0}),setTimeout(function(){0<L.length&&(a.debug&&!M&&H("One or more raiders' JSON feeds failed to load..."),P())},2E3))}})}})(jQuery);
